<script src="https://www.dynamsoft.com/libs/dbr.js"></script>
<script>
    const videoElement = document.getElementById('video');
    const outputElement = document.getElementById('output');
    const barcodeListElement = document.getElementById('barcodeList');

    // Initialize Dynamsoft Barcode Reader
    Dynamsoft.BarcodeReader.loadWasm();
    
    const scanner = new Dynamsoft.BarcodeReader();

    // Start video capture
    async function startScanning() {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        videoElement.srcObject = stream;
        
        // Start scanning when the video feed is available
        const videoTrack = stream.getVideoTracks()[0];
        const videoCapture = new VideoCapture(videoTrack);

        setInterval(async () => {
            const results = await scanner.decode(videoCapture);
            if (results.length > 0) {
                addBarcodeToList(results[0].BarcodeText);
            }
        }, 100);
    }

    function addBarcodeToList(barcode) {
        const listItem = document.createElement("li");
        listItem.textContent = barcode;
        barcodeListElement.appendChild(listItem);
    }

    startScanning();
</script>
